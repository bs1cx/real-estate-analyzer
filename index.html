<!DOCTYPE html>
<html lang="tr">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Gayrimenkul Analiz Paneli</title>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap"
      rel="stylesheet"
    />
    <link
      rel="stylesheet"
      href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
      integrity="sha384-k9ItpF+TmfZjCk2fzGEGZm4G6dkprdOCi/hTyBC0bYKT1eZq9VHtVHCfQWmvMRG4"
      crossorigin=""
    />
    <link rel="stylesheet" href="./assets/styles.css" />
  </head>
  <body>
    <div class="page">
      <header>
        <div class="header-inner">
          <div>
            <h1>Gayrimenkul Analiz Platformu</h1>
            <p class="header-subtitle">
              Türkiye genelindeki satış ve kira ilanlarını analiz ederek yatırım potansiyelini değerlendirin.
            </p>
          </div>
          <div class="header-meta">
            <span>Veri: JSON (statik + canlı güncellemeye hazır)</span>
            <span>Teknoloji: HTML · CSS · JavaScript · Chart.js · Leaflet</span>
          </div>
        </div>
      </header>

      <main class="body-content">
        <div class="tabs">
          <button class="tab-button active" data-tab-target="analytics">Analiz Paneli</button>
          <button class="tab-button" data-tab-target="integrations">API Entegrasyonları</button>
          <button class="tab-button" data-tab-target="scraper">Web Scraper</button>
        </div>

        <section class="tab-view active" data-tab-view="analytics">
          <section class="card">
            <h2>Filtreler</h2>
            <form id="filters-form" class="filters">
              <label class="field">
                Şehir
                <select data-filter-key="city"></select>
              </label>

              <label class="field">
                İlçe
                <select data-filter-key="district"></select>
              </label>

              <label class="field">
                Mahalle
                <select data-filter-key="neighbourhood"></select>
              </label>

              <label class="field">
                Konut Tipi
                <select data-filter-key="property_type"></select>
              </label>

              <label class="field">
                İlan Tipi
                <select data-filter-key="listing_type">
                  <option value="">Tümü</option>
                  <option value="sale">Satılık</option>
                  <option value="rent">Kiralık</option>
                </select>
              </label>

              <label class="field">
                Min m²
                <input type="number" min="0" placeholder="0" data-filter-key="min_size" />
              </label>

              <label class="field">
                Max m²
                <input type="number" min="0" placeholder="0" data-filter-key="max_size" />
              </label>

              <label class="field">
                Min Oda
                <input type="number" min="0" placeholder="0" data-filter-key="min_rooms" />
              </label>

              <label class="field">
                Max Oda
                <input type="number" min="0" placeholder="0" data-filter-key="max_rooms" />
              </label>

              <label class="field">
                Min Bina Yaşı
                <input type="number" min="0" placeholder="0" data-filter-key="min_age" />
              </label>

              <label class="field">
                Max Bina Yaşı
                <input type="number" min="0" placeholder="0" data-filter-key="max_age" />
              </label>
            </form>

            <div class="actions">
              <button type="button" class="btn btn-outline" data-action="sale">Satış Analizi</button>
              <button type="button" class="btn btn-outline" data-action="rent">Kira Analizi</button>
              <button type="button" class="btn btn-primary" data-action="investment">
                Yatırım Endeksi
              </button>
            </div>
            <div id="message-box" class="message">Veri hazırlanıyor…</div>
          </section>

          <section class="card">
            <h2>Piyasa Özeti</h2>
            <dl id="summary-list" class="metrics-grid"></dl>
          </section>

          <section class="grid">
            <div class="card">
              <div class="card-header">
                <h2>Yatırım Metrikleri</h2>
              </div>
              <div class="tag" id="recommendation-badge">—</div>
              <dl id="metric-list" class="metrics-grid" style="margin-top: 1rem"></dl>
            </div>

            <div class="card" id="map-card">
              <h2>Konum Haritası</h2>
              <p class="card-description">
                Şehir veya mahalle seçimine göre harita merkezi otomatik güncellenir.
              </p>
              <div class="map-wrapper">
                <div id="map"></div>
              </div>
            </div>
          </section>

          <section class="card">
            <h2>Fiyat Trendleri (5 Yıl)</h2>
            <div class="chart-container">
              <canvas id="trend-chart"></canvas>
            </div>
          </section>

          <section class="card">
            <h2>İçgörüler & Öneriler</h2>
            <ul id="insight-list" class="insights"></ul>
          </section>
        </section>

        <section class="tab-view" data-tab-view="integrations">
          <section class="card">
            <h2>API Bağlantıları</h2>
            <p class="card-description">
              Türkiye’de en popüler 10 emlak platformu için bağlantı noktalarınızı ekleyin.
              Her kaynak JSON olarak ilan listesi döndürmelidir. Başarılı eşleşmeler
              otomatik olarak analiz paneline aktarılır.
            </p>
            <div class="api-grid" id="connector-list"></div>
            <div class="connector-log" id="connector-log">
              API bağlantı günlükleri burada görüntülenecek.
            </div>
          </section>

          <section class="card">
            <h2>Beklenen JSON Şeması</h2>
            <p>
              API uç noktaları aşağıdaki alanları içeren bir dizi nesne döndürmelidir.
              Alan adları farklıysa eşleştirme otomatik olarak yapılmaya çalışılır.
            </p>
            <pre class="message">
[
  {
    "city": "Istanbul",
    "district": "Besiktas",
    "neighbourhood": "Etiler",
    "property_type": "Apartment",
    "size_m2": 120,
    "rooms": 4,
    "building_age": 5,
    "listing_type": "sale",
    "price": 9500000,
    "rent": null,
    "listing_date": "2024-01-01"
  }
]
            </pre>
            <p class="card-description">
              Scraper veya API istemciniz CORS kısıtlamaları nedeniyle doğrudan çağrılamıyorsa,
              araya kendi proxy sunucunuzu eklemeniz gerekebilir.
            </p>
          </section>
        </section>

        <section class="tab-view" data-tab-view="scraper">
          <section class="card">
            <h2>Web Scraper (Sahibinden.com)</h2>
            <p class="card-description">
              Bu arayüz, kendi scraper servisiniz üzerinden sahibinden.com&rsquo;daki arama veya liste sayfalarını
              tarayarak ilan detaylarını JSON formatında almanızı sağlar. Dönen kayıtlar analiz paneline eklenir.
            </p>

            <div class="scraper-settings">
              <label>
                Scraper Servis Baz URL
                <input
                  id="scraper-base-input"
                  type="url"
                  placeholder="https://scraper.yourdomain.com"
                  autocomplete="off"
                />
              </label>
              <button type="button" class="btn btn-outline" data-scraper-action="save-base">Kaydet</button>
              <button type="button" class="btn btn-outline" data-scraper-action="test-base">Bağlantıyı Test Et</button>
            </div>

            <div class="scraper-form">
              <label>
                Sahibinden URL&rsquo;si
                <input
                  id="scraper-url-input"
                  type="url"
                  placeholder="https://www.sahibinden.com/satilik?address_region=istanbul"
                  autocomplete="off"
                />
              </label>
              <div class="scraper-actions">
                <button type="button" class="btn btn-primary" data-scraper-action="scrape">İlanları Çek</button>
                <button type="button" class="btn btn-outline" data-scraper-action="clear-preview">Önizlemeyi Temizle</button>
              </div>
            </div>

            <div id="scraper-status" class="connector-status scraper-status">
              Servis URL’sini kaydedip hedef URL girerek başlayın.
            </div>
            <div id="scraper-preview" class="scraper-preview" hidden></div>
            <div id="scraper-log" class="scraper-log">
              Scraper günlükleri burada görüntülenecek.
            </div>
          </section>

          <section class="card">
            <h2>Scraper Servisini Çalıştırma</h2>
            <p class="card-description">
              Repodaki <code>scraper-service/</code> klasörü Playwright tabanlı örnek FastAPI hizmeti içerir.
              Aşağıdaki adımları izleyerek hızlıca devreye alabilirsiniz:
            </p>
            <pre class="message">
cd scraper-service
python -m venv .venv
. .venv/Scripts/activate   # macOS/Linux: source .venv/bin/activate
pip install -r requirements.txt
playwright install chromium
uvicorn main:app --reload
            </pre>
            <p class="card-description">
              Servis ayakta olduğunda <code>/scrape?url=&lt;HedefURL&gt;</code> uç noktası,
              <code>{ "listings": [...] }</code> formatında yanıt vermelidir. Dönen her kayıt
              <code>city</code>, <code>district</code>, <code>property_type</code>, <code>listing_type</code>,
              <code>price</code>, <code>rent</code>, <code>features</code> gibi alanları içermelidir.
            </p>
          </section>
        </section>
      </main>

      <footer class="footer">
        <p>
          Veri kaynağı örnek amaçlıdır. Reelde kullanmak için kendi scraping mekanizmanız veya API’nizle
          <code>data/mock_listings.json</code> dosyasını otomatik güncelleyin.
        </p>
      </footer>
    </div>

    <script
      src="https://cdn.jsdelivr.net/npm/chart.js@4.4.6/dist/chart.umd.min.js"
      integrity="sha384-IUtjUcv9L6Wt6RRTnTEnnHrm7uKoyrwPll3BAxCsfc7B1Tf9ezMG8q33JwGPfzgJ"
      crossorigin="anonymous"
    ></script>
    <script
      src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
      integrity="sha384-bjAJZciV06Pq4jG3Ejj6+UeJ8V+RaH//RUW2KIiMzFxLr0X58F3RrgPf63eFUsM1"
      crossorigin=""
    ></script>
    <script src="./assets/app.js" defer></script>
  </body>
</html>

